# xbuilder docker-compose 示例 - 生产环境
name: ${PROJECT_NAME:-app}-prod
services:
  user-service:
    image: ${REGISTRY_PREFIX}/user-service:${APP_VERSION:-latest}
    container_name: user-service
    restart: always
    ports:
      - "8081:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - JAVA_OPTS=-Xmx512m
    networks:
      - app-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/actuator/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  order-service:
    image: ${REGISTRY_PREFIX}/order-service:${APP_VERSION:-latest}
    container_name: order-service
    restart: always
    ports:
      - "8082:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - JAVA_OPTS=-Xmx512m
    networks:
      - app-network
    depends_on:
      - user-service

  gateway-service:
    image: ${REGISTRY_PREFIX}/gateway-service:${APP_VERSION:-latest}
    container_name: gateway-service
    restart: always
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=prod
    networks:
      - app-network
    depends_on:
      - user-service
      - order-service

networks:
  app-network:
    driver: bridge
